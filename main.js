(()=>{"use strict";let e=0;const t={};let n=[],o="継承";const c={継承:{middle:null,small:{}},ノーマル:{middle:null,small:{}},レア:{middle:null,small:{}},本体進化:{middle:null,small:{}},シナリオ進化:{middle:null,small:{}},継承進化:{middle:null,small:{}}},l="active",d="bigcategory__btn",r="midcategory__btn",i="smallcategory__btn",s={BIG:["継承","ノーマル","レア","本体進化","シナリオ進化","継承進化"],MIDDLE:["CLASSIC","SPRINT","MILE","LONG","DIRT","オレンジ","緑","青","赤","紫"],SMALL:["ステータスup","共","短","マ","中","長","逃","先","差","追","芝","ダ"]},a={橙:"#f3b05b",緑:"#91d533",青:"blue",赤:"red",紫:"purple",default:"#f3b05b"},u={};document.addEventListener("DOMContentLoaded",function(){u.BIG_TABS=document.getElementById("category-tabs-container"),u.MIDDLE_TABS=document.getElementById("sub-category-tabs-container"),u.SMALL_TABS=document.getElementById("small-category-tabs-container"),u.ITEMS_CONTAINER=document.getElementById("items-container"),u.SELECTED_ITEMS=document.getElementById("selected-items-container"),u.SKILL_POINTS=document.getElementById("skill-points"),u.MODE_DEL_RADIO=document.getElementById("mode-del"),document.getElementById("reset-button").onclick=_;const e=document.getElementById("uncheck-all-button");e&&(e.onclick=B),fetch("data.csv").then(e=>e.text()).then(E).catch(e=>console.error("CSV読み込み失敗:",e))});const m=(e,t,n)=>({name:e,points:parseInt(t,10)||0,iconColor:n});function E(e){e.trim().split("\n").forEach(e=>{const n=e.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(e=>e.trim()),[o,c,l,d,r,i,s]=n;if(!d||!r)return;t[d]??={},t[d][r]??={};const a=m(o,c,l);[i,s].forEach(e=>{e&&(t[d][r][e]??=[],t[d][r][e].push(a))})});for(const e in t){const n=Object.keys(t[e]);let o;o=["ノーマル","レア"].includes(e)?p(n,s.MIDDLE):["継承","本体進化","継承進化"].includes(e)?[...n].sort():"シナリオ進化"===e?[...n].reverse():n,t[e].__sortedMiddle=o;for(const o of n){const n=Object.keys(t[e][o]||{});let c;c=["ノーマル","レア"].includes(e)?p(n,s.SMALL):[...n].sort(),t[e][o].__sortedSmall=c}}u.BIG_TABS.innerHTML="",s.BIG.forEach(e=>{if(!t[e])return;const n=S(e,d,e===o,()=>{o=e,U(n,d),f(e)});u.BIG_TABS.appendChild(n)}),f(o)}function U(e,t){e.parentElement.querySelectorAll(`.${t}.${l}`).forEach(e=>e.classList.remove(l)),e.classList.add(l)}function p(e,t=null,n=!1){let o=t?e.filter(e=>t.includes(e)).sort((e,n)=>t.indexOf(e)-t.indexOf(n)):[...e].sort();return n&&o.reverse(),o}function S(e,t,n,o){const c=document.createElement("div");return c.className=t+(n?` ${l}`:""),c.textContent=e,c.onclick=o,c}function f(e){u.MIDDLE_TABS.innerHTML="",u.SMALL_TABS.innerHTML="",u.ITEMS_CONTAINER.innerHTML="";const n=t[e]?.__sortedMiddle||[],o=function(e,t){const n=c[e];let o=n.middle;return t.includes(o)||(o=t[0]),n.middle=o,o}(e,n);n.forEach(t=>{const n=S(t,r,t===o,()=>{c[e].middle=t,U(n,r),L(e,t)});u.MIDDLE_TABS.appendChild(n)}),L(e,o)}function L(e,n){u.SMALL_TABS.innerHTML="",u.ITEMS_CONTAINER.innerHTML="";const o=(t[e]?.[n]||{}).__sortedSmall||[],l=function(e,t,n){const o=c[e];let l=o.small[t];return n.includes(l)||(l=n[0]),o.small[t]=l,l}(e,n,o);o.forEach(t=>{const o=S(t,i,t===l,()=>{U(o,i),I(e,n,t),c[e].small[n]=t});u.SMALL_TABS.appendChild(o)}),I(e,n,l)}function I(e,o,c){const l=t[e]?.[o]?.[c]||[];u.ITEMS_CONTAINER.innerHTML="";const d=document.createDocumentFragment();l.forEach(t=>{const c=document.createElement("button");c.className="item-button",c.textContent=`${t.name} (${t.points})`,c.onclick=()=>function(e){n.push({...e,checked:!1}),C()}({...t,bigCategory:e,middleCategory:o}),d.appendChild(c)}),u.ITEMS_CONTAINER.appendChild(d)}const h=()=>{const e=u.MODE_DEL_RADIO;return e&&e.checked?"del":"chk"};function C(){e=n.reduce((e,t)=>e+(t.points||0),0),u.SKILL_POINTS.textContent=`${e}`,function(){u.SELECTED_ITEMS.innerHTML="<h6></h6>";const e=document.createDocumentFragment();n.forEach(e=>{void 0===e.checked&&(e.checked=!1)}),n.forEach((t,o)=>{const c=document.createElement("div");c.className="selected-item",c.dataset.category=t.bigCategory;const l=a[t.iconColor]||a.default;c.innerHTML=`<span style="color:${l}; font-size:1.2em;">■</span> ${t.name} (${t.points})`,t.checked&&(c.style.border="2px solid red",c.classList.add("checked-item")),c.onclick=()=>{const e=h();var c;"del"===e?(c=o,n.splice(c,1),C()):"chk"===e&&(t.checked=!t.checked,C())},e.appendChild(c)}),u.SELECTED_ITEMS.appendChild(e)}(),k()}function _(){n=[],C()}function B(){n.forEach(e=>{e.checked=!1}),C()}let y=510;function T(){const e=Number(document.querySelector('input[name="star"]:checked')?.value||1),t=Number(document.querySelector('input[name="level"]:checked')?.value||1);y=e*t,koyu_pt.innerText=`${y}  `,k()}document.querySelectorAll('input[name="star"], input[name="level"]').forEach(e=>{e.addEventListener("change",T)}),window.addEventListener("load",T);const A=2e3,D={spdPt:0,stmPt:0,powPt:0,gutPt:0,wizPt:0},M=[{id:"spd",label:"spd_pt",key:"spdPt"},{id:"sta",label:"sta_pt",key:"stmPt"},{id:"pow",label:"pow_pt",key:"powPt"},{id:"gut",label:"gut_pt",key:"gutPt"},{id:"wiz",label:"wiz_pt",key:"wizPt"}];M.forEach(({id:e,label:t,key:n})=>{const o=document.getElementById(e),c=document.getElementById(t);o.addEventListener("input",()=>{const e=function(e){const t=(n=e)<0?0:n>A?A:n;var n;let o=0;return 0===t?0:(o=t<=1200?function(e){let t=0,n=0;const o=[5,8,10,13,16,18,21,24,26,28,29,30,31,33,34,35,39,41,42,43,52,55,66,68,68];for(let c=1;c<=e;c++)c<=49?t=0:c<=99?t=1:c%50==0&&t++,n+=o[t];return n}(t):function(e){let t=0,n=38413;const o=[79,80,81,83,84,85,86,88,89,90,92,93,94,96,97,98,100,101,102,103,105,106,107,109,110,111,113,114,115,117,118,119,121,122,123,124,126,127,128,130,131,132,134,135,136,138,139,140,141,143,144,145,147,148,149,151,152,153,155,156,157,159,160,161,162,164,165,166,168,169,170,172,173,174,176,177,178,179,181,182,182];for(let c=1201;c<=e;c++)c<=1209?t=0:c<=1219?t=1:c%10==0&&t++,n+=o[t];return n}(t),Math.round(o/10))}(Number(o.value));D[n]=e,c.innerText=`${e}`,k()})}),window.addEventListener("load",()=>{M.forEach(({id:e})=>{const t=new Event("input");document.getElementById(e).dispatchEvent(t)})}),document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelectorAll("#stas_box input[type='number']");function t(){e.forEach(e=>{e.value=e.value.replace(/[^0-9]/g,"");let t=""===e.value?0:Number(e.value);t>A&&(t=A,e.value=A)})}e.forEach(e=>{e.addEventListener("input",t)}),t()});const b=document.getElementById("totalPointsContainerBottom"),g=document.getElementById("remainPointsContainer"),v=[[299,"G"],[599,"G+"],[899,"F"],[1299,"F+"],[1799,"E"],[2299,"E+"],[2899,"D"],[3499,"D+"],[4899,"C"],[6499,"C+"],[8199,"B"],[9999,"B+"],[12099,"A"],[14499,"A+"],[15899,"S"],[17499,"S+"],[19199,"SS"],[19599,"SS+"],[19999,"UG"],[20399,"UG1"],[20799,"UG2"],[21199,"UG3"],[21599,"UG4"],[22099,"UG5"],[22499,"UG6"],[22999,"UG7"],[23399,"UG8"],[23899,"UG9"],[24299,"UF"],[24799,"UF1"],[25299,"UF2"],[25799,"UF3"],[26299,"UF4"],[26799,"UF5"],[27299,"UF6"],[27799,"UF7"],[28299,"UF8"],[28799,"UF9"],[29399,"UE"],[29899,"UE1"],[30399,"UE2"],[30999,"UE3"],[31499,"UE4"],[32099,"UE5"],[32699,"UE6"],[33199,"UE7"],[33799,"UE8"],[34399,"UE9"],[34999,"UD"],[35599,"UD1"],[36199,"UD2"],[36799,"UD3"],[37499,"UD4"],[38099,"UD5"],[38699,"UD6"],[39399,"UD7"],[39999,"UD8"],[40699,"UD9"],[41299,"UC"],[41999,"UC1"],[42699,"UC2"],[43399,"UC3"],[43999,"UC4"],[44699,"UC5"],[45399,"UC6"],[46199,"UC7"],[46899,"UC8"],[47599,"UC9"],[48299,"UB"],[48999,"UB1"],[49799,"UB2"],[50499,"UB3"],[51299,"UB4"],[51999,"UB5"],[52799,"UB6"],[53599,"UB7"],[54399,"UB8"],[55199,"UB9"],[55899,"UA"],[56699,"UA1"],[57499,"UA2"],[58399,"UA3"],[59199,"UA4"],[59999,"UA5"],[60799,"UA6"],[61699,"UA7"],[62499,"UA8"],[63399,"UA9"],[64199,"US"],[65099,"US1"],[66399,"US2"],[67699,"US3"],[68999,"US4"],[70299,"US5"],[71599,"US6"],[72899,"US7"],[74399,"US8"]];function k(){const t=Object.values(D).reduce((e,t)=>e+t,0)+e+y,n=function(e){for(const[t,n]of v)if(e<=t)return n;return"US9"}(t),o=41299-t;b&&g?(b.textContent=`${n} : ${t}`,g.textContent=o>=0?`UC上限まで残り : ${o}`:"UC上限OVER : "+-o):console.warn("評価点表示用の要素が見つかりませんでした")}})();