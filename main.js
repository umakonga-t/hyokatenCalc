let categories={},selectedItems=[],currentBigCategory="継承",currentMiddleCategory=null,skillPt=0;function loadCSVData(){fetch("data.csv").then(e=>e.text()).then(parseCSV).catch(e=>console.error("CSV読み込み失敗:",e))}function parseCSV(e){e.trim().split("\n").forEach(e=>{let[t,n,r,l,i,s,a]=e.split(",").map(e=>e.trim());categories[l]??={},categories[l][i]??={},[s,a].forEach(e=>{e&&(categories[l][i][e]??=[],categories[l][i][e].push({name:t,points:n,iconColor:r}))})}),generateCategoryTabs()}function setActiveTab(e,t){let n=e.parentElement;n.querySelectorAll(`.${t}.active`).forEach(e=>e.classList.remove("active")),e.classList.add("active")}function sortCategories(e,t=null,n=!1){return t?e.filter(e=>t.includes(e)).sort((e,n)=>t.indexOf(e)-t.indexOf(n)):n?[...e].reverse():e.sort()}function generateCategoryTabs(){let e=document.getElementById("category-tabs-container");e.innerHTML="",["継承","ノーマル","レア","本体進化","シナリオ進化"].forEach(t=>{if(!categories[t])return;let n=document.createElement("div");n.className="tab"+(t===currentBigCategory?" active":""),n.textContent=t,n.onclick=()=>{setActiveTab(n,"tab"),currentBigCategory=t,showMiddleCategories(t)},e.appendChild(n)}),showMiddleCategories(currentBigCategory)}function showMiddleCategories(e){let t=document.getElementById("sub-category-tabs-container"),n=document.getElementById("small-category-tabs-container"),r=document.getElementById("items-container");t.innerHTML=n.innerHTML=r.innerHTML="";let l=Object.keys(categories[e]);"ノーマル"===e||"レア"===e?l=sortCategories(l,["SPRINT","MILE","CLASSIC","LONG","オレンジ","緑","青","赤","紫",]):"継承"===e||"本体進化"===e?l.sort():"シナリオ進化"===e&&l.reverse(),l.forEach((n,r)=>{let l=document.createElement("div");l.className="sub-tab"+(0===r?" active":""),l.textContent=n,l.onclick=()=>{setActiveTab(l,"sub-tab"),currentMiddleCategory=n,showSmallCategories(e,n)},t.appendChild(l)}),l[0]&&(currentMiddleCategory=l[0],showSmallCategories(e,l[0]))}function showSmallCategories(e,t){let n=document.getElementById("small-category-tabs-container"),r=document.getElementById("items-container");n.innerHTML=r.innerHTML="";let l=Object.keys(categories[e][t]);"ノーマル"===e||"レア"===e?l=sortCategories(l,["ステータスup","共","短","マ","中","長","逃","先","差","追","芝","ダ",]):("継承"===e||"本体進化"===e)&&l.sort(),l.forEach((r,l)=>{let i=document.createElement("div");i.className="small-category-tab"+(0===l?" active":""),i.textContent=r,i.onclick=()=>{setActiveTab(i,"small-category-tab"),displayItems(e,t,r)},n.appendChild(i)}),l[0]&&displayItems(e,t,l[0])}function displayItems(e,t,n){let r=document.getElementById("items-container"),l=categories[e]?.[t]?.[n]||[];r.innerHTML=l.map((e,t)=>`<button class="item-button" data-index="${t}">${e.name} (${e.points})</button>`).join(""),r.querySelectorAll(".item-button").forEach(n=>{let r=n.dataset.index;n.onclick=()=>addItemToSelected({...l[r],bigCategory:e,middleCategory:t})})}function addItemToSelected(e){selectedItems.push(e),updateSelectedItems()}function updateSelectedItems(){let e=document.getElementById("selected-items-container"),t={橙:"#f3b05b",緑:"#91d533",青:"blue",赤:"red",紫:"purple"};e.innerHTML="<h6></h6>",selectedItems.forEach((n,r)=>{let l=document.createElement("div");l.className="selected-item",l.setAttribute("data-category",n.bigCategory);let i=t[n.iconColor]||"#f3b05b";l.innerHTML=`<span style="color:${i}; font-size:1.2em;">■</span> ${n.name} (${n.points})`,l.onclick=()=>removeItemFromSelected(r),e.appendChild(l)}),skillPt=selectedItems.reduce((e,t)=>e+parseInt(t.points,10),0),document.getElementById("skill-points").textContent=`${skillPt}pt`,inputChangeTotalPt()}function removeItemFromSelected(e){selectedItems.splice(e,1),updateSelectedItems()}window.onload=()=>loadCSVData(),document.getElementById("reset-button").onclick=()=>{selectedItems=[],updateSelectedItems()};let koyuPt=510;const star2=document.getElementById("star2"),star3=document.getElementById("star3"),level1=document.getElementById("level1"),level2=document.getElementById("level2"),level3=document.getElementById("level3"),level4=document.getElementById("level4"),level5=document.getElementById("level5"),level6=document.getElementById("level6");function calcKoyuPt(e){let t=document.querySelector('input[name="star"]:checked').value,n=document.querySelector('input[name="level"]:checked').value;koyuPt=Number(t)*Number(n),koyu_pt.innerText=koyuPt+"pt",inputChangeTotalPt()}let star=document.getElementById("star");star2.addEventListener("change",calcKoyuPt),star3.addEventListener("change",calcKoyuPt);let level=document.getElementById("level");level1.addEventListener("change",calcKoyuPt),level2.addEventListener("change",calcKoyuPt),level3.addEventListener("change",calcKoyuPt),level4.addEventListener("change",calcKoyuPt),level5.addEventListener("change",calcKoyuPt),level6.addEventListener("change",calcKoyuPt),window.addEventListener("load",function(){calcKoyuPt()});let spdPt,stmPt,powPt,gutPt,wizPt,spd=document.getElementById("spd");spd.addEventListener("input",inputChangeSpd);let sta=document.getElementById("sta");sta.addEventListener("input",inputChangeSta);let pow=document.getElementById("pow");pow.addEventListener("input",inputChangePow);let gut=document.getElementById("gut");gut.addEventListener("input",inputChangeGut);let int=document.getElementById("int");function inputChangeSpd(e){spdPt=calcStatusPtMain(Number(spd.value)),spd_pt.innerText=spdPt+"pt",inputChangeTotalPt()}function inputChangeSta(e){stmPt=calcStatusPtMain(Number(sta.value)),sta_pt.innerText=stmPt+"pt",inputChangeTotalPt()}function inputChangePow(e){powPt=calcStatusPtMain(Number(pow.value)),pow_pt.innerText=powPt+"pt",inputChangeTotalPt()}function inputChangeGut(e){gutPt=calcStatusPtMain(Number(gut.value)),gut_pt.innerText=gutPt+"pt",inputChangeTotalPt()}function inputChangeInt(e){wizPt=calcStatusPtMain(Number(int.value)),int_pt.innerText=wizPt+"pt",inputChangeTotalPt()}function calcStatusPtMain(e){let t=inputCheckStas(e);return 0==t?0:Math.round((statusPt=t<=1200?culcStasPt(Number(t)):culcStasPtOver1200(Number(t)))/10)}int.addEventListener("input",inputChangeInt),window.addEventListener("load",function(){inputChangeSpd(),inputChangeSta(),inputChangePow(),inputChangeGut(),inputChangeInt()});const maxStas=2e3;function inputCheckStas(e){let t;return e>=0&&e<=2e3?e:e>2e3?2e3:0}function culcStasPt(e){let t,n=0,r=[5,8,10,13,16,18,21,24,26,28,29,30,31,33,34,35,39,41,42,43,52,55,66,68,68,];if(e>0&&e<=1200)for(let l=1;l<=e;l++)l<=49?t=0:l>=50&&l<=99?t=1:l%50==0&&(t+=1),n+=r[t];return n}function culcStasPtOver1200(e){let t,n=38413,r=[79,80,81,83,84,85,86,88,89,90,92,93,94,96,97,98,100,101,102,103,105,106,107,109,110,111,113,114,115,117,118,119,121,122,123,124,126,127,128,130,131,132,134,135,136,138,139,140,141,143,144,145,147,148,149,151,152,153,155,156,157,159,160,161,162,164,165,166,168,169,170,172,173,174,176,177,178,179,181,182,182,];if(e>1200&&e<=2e3)for(let l=1201;l<=e;l++)l<=1209?t=0:l>=1210&&l<=1219?t=1:l%10==0&&(t+=1),n+=r[t];return n}function inputChangeTotalPt(){let e=spdPt+stmPt+powPt+gutPt+wizPt+koyuPt+skillPt,t=calcRank(e),n=29399-e;totalPointsContainerBottom.textContent=`${t} : ${e}`,n>=0?remainPointsContainer.textContent=`UE上限まで残り : ${n}`:(n*=-1,remainPointsContainer.textContent=`UE上限OVER : ${n}`)}function calcRank(e){if(e<=299)return"G";if(e<=599)return"G+";if(e<=899)return"F";if(e<=1299)return"F+";if(e<=1799)return"E";else if(e<=2299)return"E+";else if(e<=2899)return"D";else if(e<=3499)return"D+";else if(e<=4899)return"C";else if(e<=6499)return"C+";else if(e<=8199)return"B";else if(e<=9999)return"B+";else if(e<=12099)return"A";else if(e<=14499)return"A+";else if(e<=15899)return"S";else if(e<=17499)return"S+";else if(e<=19199)return"SS";else if(e<=19599)return"SS+";else if(e<=19999)return"UG";else if(e<=20399)return"UG1";else if(e<=20799)return"UG2";else if(e<=21199)return"UG3";else if(e<=21599)return"UG4";else if(e<=22099)return"UG5";else if(e<=22499)return"UG6";else if(e<=22999)return"UG7";else if(e<=23399)return"UG8";else if(e<=23899)return"UG9";else if(e<=24299)return"UF";else if(e<=24799)return"UF1";else if(e<=25299)return"UF2";else if(e<=25799)return"UF3";else if(e<=26299)return"UF4";else if(e<=26799)return"UF5";else if(e<=27299)return"UF6";else if(e<=27799)return"UF7";else if(e<=28299)return"UF8";else if(e<=28799)return"UF9";else if(e<=29399)return"UE";else if(e<=29899)return"UE1";else if(e<=30399)return"UE2";else if(e<=30999)return"UE3";else if(e<=31499)return"UE4";else if(e<=32099)return"UE5";else if(e<=32699)return"UE6";else if(e<=33199)return"UE7";else if(e<=33799)return"UE8";else if(e<=34399)return"UE9";else if(e<=34999)return"UD";else if(e<=35599)return"UD1";else if(e<=36199)return"UD2";else if(e<=36799)return"UD3";else if(e<=37499)return"UD4";else if(e<=38099)return"UD5";else if(e<=38699)return"UD6";else if(e<=39399)return"UD7";else if(e<=39999)return"UD8";else if(e<=40699)return"UD9";else if(e<=41299)return"UC";else if(e<=41999)return"UC1";else if(e<=42699)return"UC2";else if(e<=43399)return"UC3";else if(e<=43999)return"UC4";else if(e<=44699)return"UC5";else if(e<=45399)return"UC6";else if(e<=46199)return"UC7";else if(e<=46899)return"UC8";else if(e<=47599)return"UC9";else if(e<=48299)return"UB";else if(e<=48999)return"UB1";else if(e<=49799)return"UB2";else if(e<=50499)return"UB3";else if(e<=51299)return"UB4";else if(e<=51999)return"UB5";else if(e<=52799)return"UB6";else if(e<=53599)return"UB7";else if(e<=54399)return"UB8";else if(e<=55199)return"UB9";else if(e<=55899)return"UA";else if(e<=56699)return"UA1";else if(e<=57499)return"UA2";else if(e<=58399)return"UA3";else if(e<=59199)return"UA4";else if(e<=59999)return"UA5";else if(e<=60799)return"UA6";else if(e<=61699)return"UA7";else if(e<=62499)return"UA8";else if(e<=63399)return"UA9";else if(e<=64199)return"US";else if(e<=65099)return"US1";else if(e<=65999)return"US2";else if(e<=66799)return"US3";else if(e<=67699)return"US4";else if(e<=68599)return"US5";else if(e<=69499)return"US6";else if(e<=70399)return"US7";else if(e<=71399)return"US8";else return"US9"}document.addEventListener("DOMContentLoaded",function(){let e=document.querySelectorAll("#stas_box input[type='number']"),t=document.getElementById("stas_error");function n(){let n=!1;e.forEach(e=>{let t=e.value;""===t||Number(t)>=0&&2e3>=Number(t)?e.setCustomValidity(""):Number(t)>2e3?(e.value=2e3,e.setCustomValidity("invalid"),n=!0):(e.setCustomValidity("invalid"),n=!0)}),t.style.display=n?"block":"none"}e.forEach(e=>{e.addEventListener("input",n)}),n()});