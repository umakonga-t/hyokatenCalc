(()=>{"use strict";let e=0;const t={};let n=[],o="継承";const c={継承:{middle:null,small:{}},ノーマル:{middle:null,small:{}},レア:{middle:null,small:{}},本体進化:{middle:null,small:{}},シナリオ進化:{middle:null,small:{}},継承進化:{middle:null,small:{}}};function l(e){e.trim().split("\n").forEach(e=>{const n=e.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(e=>e.trim()),[o,c,l,a,i,d,r]=n;a&&i&&(t[a]??={},t[a][i]??={},[d,r].forEach(e=>{e&&(t[a][i][e]??=[],t[a][i][e].push({name:o,points:parseInt(c,10)||0,iconColor:l}))}))}),function(){const e=document.getElementById("category-tabs-container");e.innerHTML="",["継承","ノーマル","レア","本体進化","シナリオ進化","継承進化"].forEach(n=>{if(!t[n])return;const c=document.createElement("div");c.className="bigcategory__btn"+(n===o?" active":""),c.textContent=n,c.onclick=()=>{o=n,a(c,"bigcategory__btn"),d(n)},e.appendChild(c)}),d(o)}()}function a(e,t){e.parentElement.querySelectorAll(`.${t}.active`).forEach(e=>e.classList.remove("active")),e.classList.add("active")}function i(e,t=null,n=!1){let o=t?e.filter(e=>t.includes(e)).sort((e,n)=>t.indexOf(e)-t.indexOf(n)):[...e].sort();return n&&o.reverse(),o}function d(e){const n=document.getElementById("sub-category-tabs-container"),o=document.getElementById("small-category-tabs-container"),l=document.getElementById("items-container");n.innerHTML="",o.innerHTML="",l.innerHTML="";let d=Object.keys(t[e]||{});const s="シナリオ進化"===e;["ノーマル","レア"].includes(e)?d=i(d,["CLASSIC","SPRINT","MILE","LONG","DIRT","オレンジ","緑","青","赤","紫"]):["継承","本体進化","継承進化"].includes(e)?d.sort():s&&d.reverse();let u=c[e].middle;d.includes(u)||(u=d[0]),c[e].middle=u,d.forEach(t=>{const o=document.createElement("div");o.className="midcategory__btn"+(t===u?" active":""),o.textContent=t,o.onclick=()=>{c[e].middle=t,a(o,"midcategory__btn"),r(e,t)},n.appendChild(o)}),r(e,u)}function r(e,n){const o=document.getElementById("small-category-tabs-container"),l=document.getElementById("items-container");o.innerHTML="",l.innerHTML="";let d=Object.keys(t[e][n]||{});d=["ノーマル","レア"].includes(e)?i(d,["ステータスup","共","短","マ","中","長","逃","先","差","追","芝","ダ"]):d.sort();let r=c[e].small[n];d.includes(r)||(r=d[0]),c[e].small[n]=r,d.forEach(t=>{const l=document.createElement("div");l.className="smallcategory__btn"+(t===r?" active":""),l.textContent=t,l.onclick=()=>{a(l,"smallcategory__btn"),s(e,n,t),c[e].small[n]=t},o.appendChild(l)}),s(e,n,r)}function s(e,o,c){const l=document.getElementById("items-container"),a=t[e]?.[o]?.[c]||[];l.innerHTML="";const i=document.createDocumentFragment();a.forEach(t=>{const c=document.createElement("button");c.className="item-button",c.textContent=`${t.name} (${t.points})`,c.onclick=()=>function(e){n.push(e),u()}({...t,bigCategory:e,middleCategory:o}),i.appendChild(c)}),l.appendChild(i)}function u(){const t=document.getElementById("selected-items-container");t.innerHTML="<h6></h6>";const o=document.createDocumentFragment(),c={橙:"#f3b05b",緑:"#91d533",青:"blue",赤:"red",紫:"purple"};n.forEach((e,t)=>{const l=document.createElement("div");l.className="selected-item",l.dataset.category=e.bigCategory;const a=c[e.iconColor]||"#f3b05b";l.innerHTML=`<span style="color:${a}; font-size:1.2em;">■</span> ${e.name} (${e.points})`,l.onclick=()=>{return e=t,n.splice(e,1),void u();var e},o.appendChild(l)}),t.appendChild(o),e=n.reduce((e,t)=>e+(t.points||0),0),document.getElementById("skill-points").textContent=`${e}`,C()}document.addEventListener("DOMContentLoaded",()=>{fetch("data.csv").then(e=>e.text()).then(l).catch(e=>console.error("CSV読み込み失敗:",e))}),document.getElementById("reset-button").onclick=()=>{n=[],u()};let m=510;function U(){const e=Number(document.querySelector('input[name="star"]:checked')?.value||1),t=Number(document.querySelector('input[name="level"]:checked')?.value||1);m=e*t,koyu_pt.innerText=`${m}  `,C()}document.querySelectorAll('input[name="star"], input[name="level"]').forEach(e=>{e.addEventListener("change",U)}),window.addEventListener("load",U);const E=2e3,p={spdPt:0,stmPt:0,powPt:0,gutPt:0,wizPt:0},y=[{id:"spd",label:"spd_pt",key:"spdPt"},{id:"sta",label:"sta_pt",key:"stmPt"},{id:"pow",label:"pow_pt",key:"powPt"},{id:"gut",label:"gut_pt",key:"gutPt"},{id:"wiz",label:"wiz_pt",key:"wizPt"}];y.forEach(({id:e,label:t,key:n})=>{const o=document.getElementById(e),c=document.getElementById(t);o.addEventListener("input",()=>{const e=function(e){const t=(n=e)<0?0:n>E?E:n;var n;let o=0;return 0===t?0:(o=t<=1200?function(e){let t=0,n=0;const o=[5,8,10,13,16,18,21,24,26,28,29,30,31,33,34,35,39,41,42,43,52,55,66,68,68];for(let c=1;c<=e;c++)c<=49?t=0:c<=99?t=1:c%50==0&&t++,n+=o[t];return n}(t):function(e){let t=0,n=38413;const o=[79,80,81,83,84,85,86,88,89,90,92,93,94,96,97,98,100,101,102,103,105,106,107,109,110,111,113,114,115,117,118,119,121,122,123,124,126,127,128,130,131,132,134,135,136,138,139,140,141,143,144,145,147,148,149,151,152,153,155,156,157,159,160,161,162,164,165,166,168,169,170,172,173,174,176,177,178,179,181,182,182];for(let c=1201;c<=e;c++)c<=1209?t=0:c<=1219?t=1:c%10==0&&t++,n+=o[t];return n}(t),Math.round(o/10))}(Number(o.value));p[n]=e,c.innerText=`${e}`,C()})}),window.addEventListener("load",()=>{y.forEach(({id:e})=>{const t=new Event("input");document.getElementById(e).dispatchEvent(t)})}),document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelectorAll("#stas_box input[type='number']");function t(){e.forEach(e=>{e.value=e.value.replace(/[^0-9]/g,"");let t=""===e.value?0:Number(e.value);t>E&&(t=E,e.value=E)})}e.forEach(e=>{e.addEventListener("input",t)}),t()});const f=document.getElementById("totalPointsContainerBottom"),g=document.getElementById("remainPointsContainer"),b=[[299,"G"],[599,"G+"],[899,"F"],[1299,"F+"],[1799,"E"],[2299,"E+"],[2899,"D"],[3499,"D+"],[4899,"C"],[6499,"C+"],[8199,"B"],[9999,"B+"],[12099,"A"],[14499,"A+"],[15899,"S"],[17499,"S+"],[19199,"SS"],[19599,"SS+"],[19999,"UG"],[20399,"UG1"],[20799,"UG2"],[21199,"UG3"],[21599,"UG4"],[22099,"UG5"],[22499,"UG6"],[22999,"UG7"],[23399,"UG8"],[23899,"UG9"],[24299,"UF"],[24799,"UF1"],[25299,"UF2"],[25799,"UF3"],[26299,"UF4"],[26799,"UF5"],[27299,"UF6"],[27799,"UF7"],[28299,"UF8"],[28799,"UF9"],[29399,"UE"],[29899,"UE1"],[30399,"UE2"],[30999,"UE3"],[31499,"UE4"],[32099,"UE5"],[32699,"UE6"],[33199,"UE7"],[33799,"UE8"],[34399,"UE9"],[34999,"UD"],[35599,"UD1"],[36199,"UD2"],[36799,"UD3"],[37499,"UD4"],[38099,"UD5"],[38699,"UD6"],[39399,"UD7"],[39999,"UD8"],[40699,"UD9"],[41299,"UC"],[41999,"UC1"],[42699,"UC2"],[43399,"UC3"],[43999,"UC4"],[44699,"UC5"],[45399,"UC6"],[46199,"UC7"],[46899,"UC8"],[47599,"UC9"],[48299,"UB"],[48999,"UB1"],[49799,"UB2"],[50499,"UB3"],[51299,"UB4"],[51999,"UB5"],[52799,"UB6"],[53599,"UB7"],[54399,"UB8"],[55199,"UB9"],[55899,"UA"],[56699,"UA1"],[57499,"UA2"],[58399,"UA3"],[59199,"UA4"],[59999,"UA5"],[60799,"UA6"],[61699,"UA7"],[62499,"UA8"],[63399,"UA9"],[64199,"US"],[65099,"US1"],[66399,"US2"],[67699,"US3"],[68999,"US4"],[70299,"US5"],[71599,"US6"],[72899,"US7"],[74399,"US8"]];function C(){const t=Object.values(p).reduce((e,t)=>e+t,0)+e+m,n=function(e){for(const[t,n]of b)if(e<=t)return n;return"US9"}(t),o=29399-t;f&&g?(f.textContent=`${n} : ${t}`,g.textContent=o>=0?`UE上限まで残り : ${o}`:"UE上限OVER : "+-o):console.warn("評価点表示用の要素が見つかりませんでした")}})();