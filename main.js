(()=>{"use strict";let e=0;const t={};let n=[],c="継承";const o={継承:{middle:null,small:{}},ノーマル:{middle:null,small:{}},レア:{middle:null,small:{}},本体進化:{middle:null,small:{}},シナリオ進化:{middle:null,small:{}},継承進化:{middle:null,small:{}}},l="active",d="bigcategory__btn",i="midcategory__btn",r="smallcategory__btn",s={BIG:["継承","ノーマル","レア","本体進化","シナリオ進化","継承進化"],MIDDLE:["CLASSIC","SPRINT","MILE","LONG","DIRT","オレンジ","緑","青","赤","紫"],SMALL:["ステータスup","共","短","マ","中","長","逃","先","差","追","芝","ダ"]},a={橙:"#f3b05b",緑:"#91d533",青:"blue",赤:"red",紫:"purple",default:"#f3b05b"},u={};document.addEventListener("DOMContentLoaded",function(){u.BIG_TABS=document.getElementById("category-tabs-container"),u.MIDDLE_TABS=document.getElementById("sub-category-tabs-container"),u.SMALL_TABS=document.getElementById("small-category-tabs-container"),u.ITEMS_CONTAINER=document.getElementById("items-container"),u.SELECTED_ITEMS=document.getElementById("selected-items-container"),u.SKILL_POINTS=document.getElementById("skill-points"),document.getElementById("reset-button").onclick=B;const e=document.getElementById("uncheck-all-button");e&&(e.onclick=y),fetch("data.csv").then(e=>e.text()).then(E).catch(e=>console.error("CSV読み込み失敗:",e))});const m=(e,t,n)=>({name:e,points:parseInt(t,10)||0,iconColor:n});function E(e){e.trim().split("\n").forEach(e=>{const n=e.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(e=>e.trim()),[c,o,l,d,i,r,s]=n;if(!d||!i)return;t[d]??={},t[d][i]??={};const a=m(c,o,l);[r,s].forEach(e=>{e&&(t[d][i][e]??=[],t[d][i][e].push(a))})}),u.BIG_TABS.innerHTML="",s.BIG.forEach(e=>{if(!t[e])return;const n=S(e,d,e===c,()=>{c=e,U(n,d),f(e)});u.BIG_TABS.appendChild(n)}),f(c)}function U(e,t){e.parentElement.querySelectorAll(`.${t}.${l}`).forEach(e=>e.classList.remove(l)),e.classList.add(l)}function p(e,t=null,n=!1){let c=t?e.filter(e=>t.includes(e)).sort((e,n)=>t.indexOf(e)-t.indexOf(n)):[...e].sort();return n&&c.reverse(),c}function S(e,t,n,c){const o=document.createElement("div");return o.className=t+(n?` ${l}`:""),o.textContent=e,o.onclick=c,o}function f(e){u.MIDDLE_TABS.innerHTML="",u.SMALL_TABS.innerHTML="",u.ITEMS_CONTAINER.innerHTML="";let n=Object.keys(t[e]||{});const c=s.MIDDLE,l="シナリオ進化"===e;["ノーマル","レア"].includes(e)?n=p(n,c):["継承","本体進化","継承進化"].includes(e)?n.sort():l&&n.reverse();const d=function(e,t){const n=o[e];let c=n.middle;return t.includes(c)||(c=t[0]),n.middle=c,c}(e,n);n.forEach(t=>{const n=S(t,i,t===d,()=>{o[e].middle=t,U(n,i),L(e,t)});u.MIDDLE_TABS.appendChild(n)}),L(e,d)}function L(e,n){u.SMALL_TABS.innerHTML="",u.ITEMS_CONTAINER.innerHTML="";const c=t[e]?.[n]||{};let l=Object.keys(c);const d=s.SMALL;l=["ノーマル","レア"].includes(e)?p(l,d):l.sort();const i=function(e,t,n){const c=o[e];let l=c.small[t];return n.includes(l)||(l=n[0]),c.small[t]=l,l}(e,n,l);l.forEach(t=>{const c=S(t,r,t===i,()=>{U(c,r),h(e,n,t),o[e].small[n]=t});u.SMALL_TABS.appendChild(c)}),h(e,n,i)}function h(e,c,o){const l=t[e]?.[c]?.[o]||[];u.ITEMS_CONTAINER.innerHTML="";const d=document.createDocumentFragment();l.forEach(t=>{const o=document.createElement("button");o.className="item-button",o.textContent=`${t.name} (${t.points})`,o.onclick=()=>function(e){n.push({...e,checked:!1}),C()}({...t,bigCategory:e,middleCategory:c}),d.appendChild(o)}),u.ITEMS_CONTAINER.appendChild(d)}const I=()=>{const e=document.getElementById("mode-del");return e&&e.checked?"del":"chk"};function C(){(function(){u.SELECTED_ITEMS.innerHTML="<h6></h6>";const e=document.createDocumentFragment();n.forEach(e=>{void 0===e.checked&&(e.checked=!1)}),n.forEach((t,c)=>{const o=document.createElement("div");o.className="selected-item",o.dataset.category=t.bigCategory;const l=a[t.iconColor]||a.default;o.innerHTML=`<span style="color:${l}; font-size:1.2em;">■</span> ${t.name} (${t.points})`,t.checked&&(o.style.border="2px solid red",o.classList.add("checked-item")),o.onclick=()=>{const e=I();var o;"del"===e?(o=c,n.splice(o,1),C()):"chk"===e&&(t.checked=!t.checked,C())},e.appendChild(o)}),u.SELECTED_ITEMS.appendChild(e)})(),e=n.reduce((e,t)=>e+(t.points||0),0),u.SKILL_POINTS.textContent=`${e}`,k()}function B(){n=[],C()}function y(){n.forEach(e=>{e.checked=!1}),C()}let T=510;function A(){const e=Number(document.querySelector('input[name="star"]:checked')?.value||1),t=Number(document.querySelector('input[name="level"]:checked')?.value||1);T=e*t,koyu_pt.innerText=`${T}  `,k()}document.querySelectorAll('input[name="star"], input[name="level"]').forEach(e=>{e.addEventListener("change",A)}),window.addEventListener("load",A);const b=2e3,g={spdPt:0,stmPt:0,powPt:0,gutPt:0,wizPt:0},_=[{id:"spd",label:"spd_pt",key:"spdPt"},{id:"sta",label:"sta_pt",key:"stmPt"},{id:"pow",label:"pow_pt",key:"powPt"},{id:"gut",label:"gut_pt",key:"gutPt"},{id:"wiz",label:"wiz_pt",key:"wizPt"}];_.forEach(({id:e,label:t,key:n})=>{const c=document.getElementById(e),o=document.getElementById(t);c.addEventListener("input",()=>{const e=function(e){const t=(n=e)<0?0:n>b?b:n;var n;let c=0;return 0===t?0:(c=t<=1200?function(e){let t=0,n=0;const c=[5,8,10,13,16,18,21,24,26,28,29,30,31,33,34,35,39,41,42,43,52,55,66,68,68];for(let o=1;o<=e;o++)o<=49?t=0:o<=99?t=1:o%50==0&&t++,n+=c[t];return n}(t):function(e){let t=0,n=38413;const c=[79,80,81,83,84,85,86,88,89,90,92,93,94,96,97,98,100,101,102,103,105,106,107,109,110,111,113,114,115,117,118,119,121,122,123,124,126,127,128,130,131,132,134,135,136,138,139,140,141,143,144,145,147,148,149,151,152,153,155,156,157,159,160,161,162,164,165,166,168,169,170,172,173,174,176,177,178,179,181,182,182];for(let o=1201;o<=e;o++)o<=1209?t=0:o<=1219?t=1:o%10==0&&t++,n+=c[t];return n}(t),Math.round(c/10))}(Number(c.value));g[n]=e,o.innerText=`${e}`,k()})}),window.addEventListener("load",()=>{_.forEach(({id:e})=>{const t=new Event("input");document.getElementById(e).dispatchEvent(t)})}),document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelectorAll("#stas_box input[type='number']");function t(){e.forEach(e=>{e.value=e.value.replace(/[^0-9]/g,"");let t=""===e.value?0:Number(e.value);t>b&&(t=b,e.value=b)})}e.forEach(e=>{e.addEventListener("input",t)}),t()});const M=document.getElementById("totalPointsContainerBottom"),v=document.getElementById("remainPointsContainer"),D=[[299,"G"],[599,"G+"],[899,"F"],[1299,"F+"],[1799,"E"],[2299,"E+"],[2899,"D"],[3499,"D+"],[4899,"C"],[6499,"C+"],[8199,"B"],[9999,"B+"],[12099,"A"],[14499,"A+"],[15899,"S"],[17499,"S+"],[19199,"SS"],[19599,"SS+"],[19999,"UG"],[20399,"UG1"],[20799,"UG2"],[21199,"UG3"],[21599,"UG4"],[22099,"UG5"],[22499,"UG6"],[22999,"UG7"],[23399,"UG8"],[23899,"UG9"],[24299,"UF"],[24799,"UF1"],[25299,"UF2"],[25799,"UF3"],[26299,"UF4"],[26799,"UF5"],[27299,"UF6"],[27799,"UF7"],[28299,"UF8"],[28799,"UF9"],[29399,"UE"],[29899,"UE1"],[30399,"UE2"],[30999,"UE3"],[31499,"UE4"],[32099,"UE5"],[32699,"UE6"],[33199,"UE7"],[33799,"UE8"],[34399,"UE9"],[34999,"UD"],[35599,"UD1"],[36199,"UD2"],[36799,"UD3"],[37499,"UD4"],[38099,"UD5"],[38699,"UD6"],[39399,"UD7"],[39999,"UD8"],[40699,"UD9"],[41299,"UC"],[41999,"UC1"],[42699,"UC2"],[43399,"UC3"],[43999,"UC4"],[44699,"UC5"],[45399,"UC6"],[46199,"UC7"],[46899,"UC8"],[47599,"UC9"],[48299,"UB"],[48999,"UB1"],[49799,"UB2"],[50499,"UB3"],[51299,"UB4"],[51999,"UB5"],[52799,"UB6"],[53599,"UB7"],[54399,"UB8"],[55199,"UB9"],[55899,"UA"],[56699,"UA1"],[57499,"UA2"],[58399,"UA3"],[59199,"UA4"],[59999,"UA5"],[60799,"UA6"],[61699,"UA7"],[62499,"UA8"],[63399,"UA9"],[64199,"US"],[65099,"US1"],[66399,"US2"],[67699,"US3"],[68999,"US4"],[70299,"US5"],[71599,"US6"],[72899,"US7"],[74399,"US8"]];function k(){const t=Object.values(g).reduce((e,t)=>e+t,0)+e+T,n=function(e){for(const[t,n]of D)if(e<=t)return n;return"US9"}(t),c=29399-t;M&&v?(M.textContent=`${n} : ${t}`,v.textContent=c>=0?`UE上限まで残り : ${c}`:"UE上限OVER : "+-c):console.warn("評価点表示用の要素が見つかりませんでした")}})();