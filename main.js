(()=>{"use strict";let e=0;const t={};let n=[],o="継承",c="normal";const d={},l={継承:{middle:null,small:{}},ノーマル:{middle:null,small:{}},レア:{middle:null,small:{}},進化:{middle:null,small:{}},シナリオ進化:{middle:null,small:{}},継承進化:{middle:null,small:{}}},i="active",r="bigcategory__btn",s="midcategory__btn",a="smallcategory__btn",u="item-button",m={BIG:["継承","ノーマル","レア","進化","シナリオ進化","継承進化"],MIDDLE:["CLASSIC","SPRINT","MILE","LONG","DIRT","オレンジ","緑","青","赤","紫"],SMALL:["共通の緑","共","短","マ","中","長","逃","先","差","追","芝","ダ"]},E={橙:"#f3b05b",緑:"#91d533",青:"blue",赤:"red",紫:"purple",default:"#f3b05b"},U={};function f(e){c=e,T(o),M()}document.addEventListener("DOMContentLoaded",function(){U.BIG_TABS=document.getElementById("category-tabs-container"),U.MIDDLE_TABS=document.getElementById("sub-category-tabs-container"),U.SMALL_TABS=document.getElementById("small-category-tabs-container"),U.ITEMS_CONTAINER=document.getElementById("items-container"),U.SELECTED_ITEMS=document.getElementById("selected-items-container"),U.SKILL_POINTS=document.getElementById("skill-points"),U.MODE_DEL_RADIO=document.getElementById("mode-del"),U.MODE_NORMAL_RADIO=document.getElementById("mode-normal"),U.MODE_EDIT_RADIO=document.getElementById("mode-edit"),U.HIDDEN_ITEMS_CONTAINER=document.getElementById("hidden-items-container"),U.SAVE_HIDDEN_BUTTON=document.getElementById("save-hidden-button"),document.getElementById("reset-button").onclick=N;const e=document.getElementById("uncheck-all-button");e&&(e.onclick=b);const t=document.getElementById("clear-hidden-button");t&&(t.onclick=g),U.SAVE_HIDDEN_BUTTON&&(U.SAVE_HIDDEN_BUTTON.onclick=D),f("normal"),fetch("data.csv").then(e=>e.text()).then(_).catch(e=>console.error("CSV読み込み失敗:",e)),U.MODE_NORMAL_RADIO&&U.MODE_NORMAL_RADIO.addEventListener("change",()=>{U.MODE_NORMAL_RADIO.checked&&f("normal")}),U.MODE_EDIT_RADIO&&U.MODE_EDIT_RADIO.addEventListener("change",()=>{U.MODE_EDIT_RADIO.checked&&f("edit")})});const I=(e,t,n)=>({name:e,points:parseInt(t,10)||0,iconColor:n});function _(e){const n=new Set;e.trim().split("\n").forEach(e=>{const o=e.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(e=>e.trim()),[c,d,l,i,r,s,a]=o;if(!i||!r)return;t[i]??={},t[i][r]??={};const u={...I(c,d,l),bigCategory:i,middleCategory:r};n.add(c),[s,a].forEach(e=>{if(e){t[i][r][e]??=[];const n={...u};t[i][r][e].push(n)}})}),n.forEach(e=>{d[e]={isHidden:!1}});for(const e in t){const n=Object.keys(t[e]);let o;o=["ノーマル","レア"].includes(e)?p(n,m.MIDDLE):["継承","進化","継承進化"].includes(e)?[...n].sort():"シナリオ進化"===e?[...n].reverse():n,t[e].__sortedMiddle=o;for(const o of n){const n=Object.keys(t[e][o]||{});let c;c=["ノーマル","レア"].includes(e)?p(n,m.SMALL):[...n].sort(),t[e][o].__sortedSmall=c}}!function(){try{const e=localStorage.getItem(S);if(!e)return;const t=new Set(JSON.parse(e));for(const e in d)d[e].isHidden=t.has(e)}catch(e){console.error("localStorageからのロードに失敗しました。",e)}}(),M(),U.BIG_TABS.innerHTML="",m.BIG.forEach(e=>{if(!t[e])return;const n=A(e,r,e===o,()=>{o=e,h(n,r),T(e)});U.BIG_TABS.appendChild(n)}),T(o)}const S="hiddenSkillItems";function D(){const e=Object.keys(d).filter(e=>d[e].isHidden);try{localStorage.setItem(S,JSON.stringify(e)),alert("非表示スキルをLocalStorageに保存しました。")}catch(e){console.error("LocalStorageへの保存に失敗しました。",e),alert("非表示スキルの保存に失敗しました。")}}function h(e,t){e.parentElement.querySelectorAll(`.${t}.${i}`).forEach(e=>e.classList.remove(i)),e.classList.add(i)}function p(e,t=null,n=!1){let o=t?e.filter(e=>t.includes(e)).sort((e,n)=>t.indexOf(e)-t.indexOf(n)):[...e].sort();return n&&o.reverse(),o}function A(e,t,n,o){const c=document.createElement("div");return c.className=t+(n?` ${i}`:""),c.textContent=e,c.onclick=o,c}function L(e){return Array.isArray(e)}function T(e){U.MIDDLE_TABS.innerHTML="",U.ITEMS_CONTAINER.innerHTML="";const n=t[e]?.__sortedMiddle||[],o=function(e,t){const n=l[e];let o=n.middle;return t.includes(o)||(o=t[0]),n.middle=o,o}(e,n);n.forEach(t=>{const n=A(t,s,t===o,()=>{l[e].middle=t,h(n,s),C(e,t)});U.MIDDLE_TABS.appendChild(n)}),C(e,o)}function C(e,n){U.SMALL_TABS.innerHTML="",U.ITEMS_CONTAINER.innerHTML="";const o=(t[e]?.[n]||{}).__sortedSmall||[],c=function(e,t,n){const o=l[e];let c=o.small[t];return n.includes(c)||(c=n[0]),o.small[t]=c,c}(e,n,o);o.forEach(t=>{const o=A(t,a,t===c,()=>{h(o,a),y(e,n,t),l[e].small[n]=t});U.SMALL_TABS.appendChild(o)}),y(e,n,c)}function y(e,o,l){const i=t[e]?.[o]?.[l]||[];U.ITEMS_CONTAINER.innerHTML="";const r=document.createDocumentFragment();i.filter(e=>!d[e.name]?.isHidden).forEach(t=>{const i=document.createElement("button");i.className=u,i.textContent=`${t.name} (${t.points})`,i.onclick=()=>{if("edit"===c){const n=d[t.name];n&&(n.isHidden=!n.isHidden),y(e,o,l),M()}else"normal"===c&&function(e){n.push({...e,checked:!1}),O()}(t)},r.appendChild(i)}),U.ITEMS_CONTAINER.appendChild(r)}function g(){let e=!1;for(const t in d)d[t].isHidden&&(d[t].isHidden=!1,e=!0);if(M(),e){const e=o,t=l[e].middle;y(e,t,l[e].small[t])}}function M(){U.HIDDEN_ITEMS_CONTAINER.innerHTML="";const e=document.createDocumentFragment(),n=[];for(const e in d)d[e].isHidden&&n.push(e);n.sort((e,t)=>e.localeCompare(t,"ja")),n.forEach(n=>{const i=(e=>{for(const n in t)for(const o in t[n])if(!o.startsWith("__"))for(const c in t[n][o]){if(c.startsWith("__"))continue;const d=t[n][o][c];if(L(d)){const t=d.find(t=>t.name===e);if(t)return t}}return null})(n);if(!i)return;const r=document.createElement("button");r.className=`${u} hidden-item-button`,r.textContent=`${i.name} (${i.points})`,r.onclick=()=>{if("edit"===c){const e=d[i.name];e&&(e.isHidden=!1),M();const t=o,n=l[t].middle;y(t,n,l[t].small[n])}},e.appendChild(r)}),U.HIDDEN_ITEMS_CONTAINER.appendChild(e)}const B=()=>{const e=U.MODE_DEL_RADIO;return e&&e.checked?"del":"chk"};function O(){e=n.reduce((e,t)=>e+(t.points||0),0),U.SKILL_POINTS.textContent=`${e}`,function(){U.SELECTED_ITEMS.innerHTML="<h6></h6>";const e=document.createDocumentFragment();n.forEach(e=>{void 0===e.checked&&(e.checked=!1)}),n.forEach((t,o)=>{const c=document.createElement("div");c.className="selected-item",c.dataset.category=t.bigCategory;const d=E[t.iconColor]||E.default;c.innerHTML=`<span style="color:${d}; font-size:1.2em;">■</span> ${t.name} (${t.points})`,t.checked&&(c.style.border="2px solid red",c.classList.add("checked-item")),c.onclick=()=>{const e=B();var c;"del"===e?(c=o,n.splice(c,1),O()):"chk"===e&&(t.checked=!t.checked,O())},e.appendChild(c)}),U.SELECTED_ITEMS.appendChild(e)}(),P()}function N(){n=[],O()}function b(){n.forEach(e=>{e.checked=!1}),O()}let k=510;function v(){const e=Number(document.querySelector('input[name="star"]:checked')?.value||1),t=Number(document.querySelector('input[name="level"]:checked')?.value||1);k=e*t,koyu_pt.innerText=`${k}  `,P()}document.querySelectorAll('input[name="star"], input[name="level"]').forEach(e=>{e.addEventListener("change",v)}),window.addEventListener("load",v);const H=2e3,R={spdPt:0,stmPt:0,powPt:0,gutPt:0,wizPt:0},G=[{id:"spd",label:"spd_pt",key:"spdPt"},{id:"sta",label:"sta_pt",key:"stmPt"},{id:"pow",label:"pow_pt",key:"powPt"},{id:"gut",label:"gut_pt",key:"gutPt"},{id:"wiz",label:"wiz_pt",key:"wizPt"}];G.forEach(({id:e,label:t,key:n})=>{const o=document.getElementById(e),c=document.getElementById(t);o.addEventListener("input",()=>{const e=function(e){const t=(n=e)<0?0:n>H?H:n;var n;let o=0;return 0===t?0:(o=t<=1200?function(e){let t=0,n=0;const o=[5,8,10,13,16,18,21,24,26,28,29,30,31,33,34,35,39,41,42,43,52,55,66,68,68];for(let c=1;c<=e;c++)c<=49?t=0:c<=99?t=1:c%50==0&&t++,n+=o[t];return n}(t):function(e){let t=0,n=38413;const o=[79,80,81,83,84,85,86,88,89,90,92,93,94,96,97,98,100,101,102,103,105,106,107,109,110,111,113,114,115,117,118,119,121,122,123,124,126,127,128,130,131,132,134,135,136,138,139,140,141,143,144,145,147,148,149,151,152,153,155,156,157,159,160,161,162,164,165,166,168,169,170,172,173,174,176,177,178,179,181,182,182];for(let c=1201;c<=e;c++)c<=1209?t=0:c<=1219?t=1:c%10==0&&t++,n+=o[t];return n}(t),Math.round(o/10))}(Number(o.value));R[n]=e,c.innerText=`${e}`,P()})}),window.addEventListener("load",()=>{G.forEach(({id:e})=>{const t=new Event("input");document.getElementById(e).dispatchEvent(t)})}),document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelectorAll("#stas_box input[type='number']");function t(){e.forEach(e=>{e.value=e.value.replace(/[^0-9]/g,"");let t=""===e.value?0:Number(e.value);t>H&&(t=H,e.value=H)})}e.forEach(e=>{e.addEventListener("input",t)}),t()});const $=document.getElementById("totalPointsContainerBottom"),w=document.getElementById("remainPointsContainer"),F=[[299,"G"],[599,"G+"],[899,"F"],[1299,"F+"],[1799,"E"],[2299,"E+"],[2899,"D"],[3499,"D+"],[4899,"C"],[6499,"C+"],[8199,"B"],[9999,"B+"],[12099,"A"],[14499,"A+"],[15899,"S"],[17499,"S+"],[19199,"SS"],[19599,"SS+"],[19999,"UG"],[20399,"UG1"],[20799,"UG2"],[21199,"UG3"],[21599,"UG4"],[22099,"UG5"],[22499,"UG6"],[22999,"UG7"],[23399,"UG8"],[23899,"UG9"],[24299,"UF"],[24799,"UF1"],[25299,"UF2"],[25799,"UF3"],[26299,"UF4"],[26799,"UF5"],[27299,"UF6"],[27799,"UF7"],[28299,"UF8"],[28799,"UF9"],[29399,"UE"],[29899,"UE1"],[30399,"UE2"],[30999,"UE3"],[31499,"UE4"],[32099,"UE5"],[32699,"UE6"],[33199,"UE7"],[33799,"UE8"],[34399,"UE9"],[34999,"UD"],[35599,"UD1"],[36199,"UD2"],[36799,"UD3"],[37499,"UD4"],[38099,"UD5"],[38699,"UD6"],[39399,"UD7"],[39999,"UD8"],[40699,"UD9"],[41299,"UC"],[41999,"UC1"],[42699,"UC2"],[43399,"UC3"],[43999,"UC4"],[44699,"UC5"],[45399,"UC6"],[46199,"UC7"],[46899,"UC8"],[47599,"UC9"],[48299,"UB"],[48999,"UB1"],[49799,"UB2"],[50499,"UB3"],[51299,"UB4"],[51999,"UB5"],[52799,"UB6"],[53599,"UB7"],[54399,"UB8"],[55199,"UB9"],[55899,"UA"],[56699,"UA1"],[57499,"UA2"],[58399,"UA3"],[59199,"UA4"],[59999,"UA5"],[60799,"UA6"],[61699,"UA7"],[62499,"UA8"],[63399,"UA9"],[64199,"US"],[65099,"US1"],[66399,"US2"],[67699,"US3"],[68999,"US4"],[70299,"US5"],[71599,"US6"],[72899,"US7"],[74399,"US8"]];function P(){const t=Object.values(R).reduce((e,t)=>e+t,0)+e+k,n=function(e){for(const[t,n]of F)if(e<=t)return n;return"US9"}(t),o=41299-t;$&&w?($.textContent=`${n} : ${t}`,w.textContent=o>=0?`UC上限まで残り : ${o}`:"UC上限OVER : "+-o):console.warn("評価点表示用の要素が見つかりませんでした")}})();