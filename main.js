(()=>{"use strict";let t={},e=[],n="継承",o=null,c=0;function a(e){e.trim().split("\n").forEach(e=>{const[n,o,c,a,i,r,l]=e.split(",").map(t=>t.trim());t[a]??={},t[a][i]??={},[r,l].forEach(e=>{e&&(t[a][i][e]??=[],t[a][i][e].push({name:n,points:o,iconColor:c}))})}),function(){const e=document.getElementById("category-tabs-container");e.innerHTML="",["継承","ノーマル","レア","本体進化","シナリオ進化","継承進化"].forEach(o=>{if(!t[o])return;const c=document.createElement("div");c.className="tab"+(o===n?" active":""),c.textContent=o,c.onclick=()=>{i(c,"tab"),n=o,l(o)},e.appendChild(c)}),l(n)}()}function i(t,e){t.parentElement.querySelectorAll(`.${e}.active`).forEach(t=>t.classList.remove("active")),t.classList.add("active")}function r(t,e=null,n=!1){return e?t.filter(t=>e.includes(t)).sort((t,n)=>e.indexOf(t)-e.indexOf(n)):n?[...t].reverse():t.sort()}function l(e){const n=document.getElementById("sub-category-tabs-container"),c=document.getElementById("small-category-tabs-container"),a=document.getElementById("items-container");n.innerHTML=c.innerHTML=a.innerHTML="";let l=Object.keys(t[e]);const d="シナリオ進化"===e;"ノーマル"===e||"レア"===e?l=r(l,["CLASSIC","SPRINT","MILE","LONG","DIRT","オレンジ","緑","青","赤","紫"]):"継承"===e||"本体進化"===e||"継承進化"===e?l.sort():d&&l.reverse(),l.forEach((t,c)=>{const a=document.createElement("div");a.className="sub-tab"+(0===c?" active":""),a.textContent=t,a.onclick=()=>{i(a,"sub-tab"),o=t,s(e,t)},n.appendChild(a)}),l[0]&&(o=l[0],s(e,l[0]))}function s(e,n){const o=document.getElementById("small-category-tabs-container"),c=document.getElementById("items-container");o.innerHTML=c.innerHTML="";let a=Object.keys(t[e][n]);"ノーマル"===e||"レア"===e?a=r(a,["ステータスup","共","短","マ","中","長","逃","先","差","追","芝","ダ"]):"継承"!==e&&"本体進化"!==e&&"継承進化"!==e||a.sort(),a.forEach((t,c)=>{const a=document.createElement("div");a.className="small-category-tab"+(0===c?" active":""),a.textContent=t,a.onclick=()=>{i(a,"small-category-tab"),d(e,n,t)},o.appendChild(a)}),a[0]&&d(e,n,a[0])}function d(n,o,c){const a=document.getElementById("items-container"),i=t[n]?.[o]?.[c]||[];a.innerHTML=i.map((t,e)=>`<button class="item-button" data-index="${e}">${t.name} (${t.points})</button>`).join(""),a.querySelectorAll(".item-button").forEach(t=>{const c=t.dataset.index;t.onclick=()=>{return t={...i[c],bigCategory:n,middleCategory:o},e.push(t),void u();var t}})}function u(){const t=document.getElementById("selected-items-container"),n={橙:"#f3b05b",緑:"#91d533",青:"blue",赤:"red",紫:"purple"};t.innerHTML="<h6></h6>",e.forEach((o,c)=>{const a=document.createElement("div");a.className="selected-item",a.setAttribute("data-category",o.bigCategory);const i=n[o.iconColor]||"#f3b05b";a.innerHTML=`<span style="color:${i}; font-size:1.2em;">■</span> ${o.name} (${o.points})`,a.onclick=()=>{return t=c,e.splice(t,1),void u();var t},t.appendChild(a)}),c=e.reduce((t,e)=>t+parseInt(e.points,10),0),document.getElementById("skill-points").textContent=`${c}pt`,C()}window.onload=()=>{fetch("data.csv").then(t=>t.text()).then(a).catch(t=>console.error("CSV読み込み失敗:",t))},document.getElementById("reset-button").onclick=()=>{e=[],u()};let m=510;function U(){const t=Number(document.querySelector('input[name="star"]:checked')?.value||1),e=Number(document.querySelector('input[name="level"]:checked')?.value||1);m=t*e,koyu_pt.innerText=`${m}pt`,C()}document.querySelectorAll('input[name="star"], input[name="level"]').forEach(t=>{t.addEventListener("change",U)}),window.addEventListener("load",U);const E={spdPt:0,stmPt:0,powPt:0,gutPt:0,wizPt:0},p=[{id:"spd",label:"spd_pt",key:"spdPt"},{id:"sta",label:"sta_pt",key:"stmPt"},{id:"pow",label:"pow_pt",key:"powPt"},{id:"gut",label:"gut_pt",key:"gutPt"},{id:"wiz",label:"wiz_pt",key:"wizPt"}];p.forEach(({id:t,label:e,key:n})=>{const o=document.getElementById(t),c=document.getElementById(e);o.addEventListener("input",()=>{const t=function(t){const e=(n=t)<0?0:n>y?y:n;var n;let o=0;return 0===e?0:(o=e<=1200?function(t){let e=0,n=0;const o=[5,8,10,13,16,18,21,24,26,28,29,30,31,33,34,35,39,41,42,43,52,55,66,68,68];for(let c=1;c<=t;c++)c<=49?e=0:c<=99?e=1:c%50==0&&e++,n+=o[e];return n}(e):function(t){let e=0,n=38413;const o=[79,80,81,83,84,85,86,88,89,90,92,93,94,96,97,98,100,101,102,103,105,106,107,109,110,111,113,114,115,117,118,119,121,122,123,124,126,127,128,130,131,132,134,135,136,138,139,140,141,143,144,145,147,148,149,151,152,153,155,156,157,159,160,161,162,164,165,166,168,169,170,172,173,174,176,177,178,179,181,182,182];for(let c=1201;c<=t;c++)c<=1209?e=0:c<=1219?e=1:c%10==0&&e++,n+=o[e];return n}(e),Math.round(o/10))}(Number(o.value));E[n]=t,c.innerText=`${t}pt`,C()})}),window.addEventListener("load",()=>{p.forEach(({id:t})=>{const e=new Event("input");document.getElementById(t).dispatchEvent(e)})});const y=2e3;document.addEventListener("DOMContentLoaded",()=>{const t=document.querySelectorAll("#stas_box input[type='number']"),e=document.getElementById("stas_error");function n(){let n=!1;t.forEach(t=>{const e=Number(t.value);""===e||e>=0&&e<=y?t.setCustomValidity(""):e>y?(t.value=y,t.setCustomValidity("invalid"),n=!0):(t.setCustomValidity("invalid"),n=!0)}),e.style.display=n?"block":"none"}t.forEach(t=>{t.addEventListener("input",n)}),n()});const b=document.getElementById("totalPointsContainerBottom"),f=document.getElementById("remainPointsContainer"),v=[[299,"G"],[599,"G+"],[899,"F"],[1299,"F+"],[1799,"E"],[2299,"E+"],[2899,"D"],[3499,"D+"],[4899,"C"],[6499,"C+"],[8199,"B"],[9999,"B+"],[12099,"A"],[14499,"A+"],[15899,"S"],[17499,"S+"],[19199,"SS"],[19599,"SS+"],[19999,"UG"],[20399,"UG1"],[20799,"UG2"],[21199,"UG3"],[21599,"UG4"],[22099,"UG5"],[22499,"UG6"],[22999,"UG7"],[23399,"UG8"],[23899,"UG9"],[24299,"UF"],[24799,"UF1"],[25299,"UF2"],[25799,"UF3"],[26299,"UF4"],[26799,"UF5"],[27299,"UF6"],[27799,"UF7"],[28299,"UF8"],[28799,"UF9"],[29399,"UE"],[29899,"UE1"],[30399,"UE2"],[30999,"UE3"],[31499,"UE4"],[32099,"UE5"],[32699,"UE6"],[33199,"UE7"],[33799,"UE8"],[34399,"UE9"],[34999,"UD"],[35599,"UD1"],[36199,"UD2"],[36799,"UD3"],[37499,"UD4"],[38099,"UD5"],[38699,"UD6"],[39399,"UD7"],[39999,"UD8"],[40699,"UD9"],[41299,"UC"],[41999,"UC1"],[42699,"UC2"],[43399,"UC3"],[43999,"UC4"],[44699,"UC5"],[45399,"UC6"],[46199,"UC7"],[46899,"UC8"],[47599,"UC9"],[48299,"UB"],[48999,"UB1"],[49799,"UB2"],[50499,"UB3"],[51299,"UB4"],[51999,"UB5"],[52799,"UB6"],[53599,"UB7"],[54399,"UB8"],[55199,"UB9"],[55899,"UA"],[56699,"UA1"],[57499,"UA2"],[58399,"UA3"],[59199,"UA4"],[59999,"UA5"],[60799,"UA6"],[61699,"UA7"],[62499,"UA8"],[63399,"UA9"],[64199,"US"],[65099,"US1"],[66399,"US2"],[67699,"US3"],[68999,"US4"],[70299,"US5"],[71599,"US6"],[72899,"US7"],[74399,"US8"]];function C(){const t=Object.values(E).reduce((t,e)=>t+e,0)+c+m,e=function(t){for(const[e,n]of v)if(t<=e)return n;return"US9"}(t),n=29399-t;b&&f?(b.textContent=`${e} : ${t}`,f.textContent=n>=0?`UE上限まで残り : ${n}`:"UE上限OVER : "+-n):console.warn("評価点表示用の要素が見つかりませんでした")}})();